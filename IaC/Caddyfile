# ============================================
# DEVELOPMENT CONFIGURATION (Local)
# Uncomment this block for local development
# ============================================
# http://localhost {
#     # CORS headers
#     header {
#         Access-Control-Allow-Origin "*"
#         Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
#         Access-Control-Allow-Headers "Content-Type, Authorization"
#         Access-Control-Allow-Credentials "true"
#     }

#     # Grafana Dashboard
#     handle /dashboard* {
#         reverse_proxy grafana:3000
#     }

#     # Auth service routes
#     handle /api/auth/* {
#         uri strip_prefix /api/auth
#         reverse_proxy auth-service:4000
#     }

#     # User service routes
#     handle /api/user/* {
#         uri strip_prefix /api/user
#         reverse_proxy user-service:5000
#     }

#     # Pong service routes (HTTP + WebSocket)
#     handle /api/pong/* {
#         uri strip_prefix /api/pong
#         reverse_proxy pong-service:6061
#     }

#     # Socket.IO WebSocket endpoint for Pong
#     handle /socket.io/* {
#         reverse_proxy pong-service:6061 {
#             # Enable WebSocket support
#             header_up Upgrade {http.request.header.Upgrade}
#             header_up Connection {http.request.header.Connection}
#         }
#     }
# 
#     # Chat service routes (HTTP + WebSocket) - for future use
#     # handle /api/chat/* {
#     #     uri strip_prefix /api/chat
#     #     reverse_proxy chat-service:7000
#     # }

#     # Frontend - everything else (fallback)
#     handle {
#         reverse_proxy frontend:80
#     }
# }

# ============================================
# PRODUCTION CONFIGURATION
# Comment out this block for local development
# ============================================
https://transcendence.keystone-gateway.dev {
    # CORS headers
    header {
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization"
        Access-Control-Allow-Credentials "true"
    }

    # Grafana Dashboard
    handle /dashboard* {
        reverse_proxy grafana:3000
    }

    # Auth service routes
    handle /api/auth/* {
        uri strip_prefix /api/auth
        reverse_proxy auth-service:4000
    }

    # User service routes
    handle /api/user/* {
        uri strip_prefix /api/user
        reverse_proxy user-service:5000
    }

    # Pong service routes (HTTP + WebSocket)
    handle /api/pong/* {
        uri strip_prefix /api/pong
        reverse_proxy pong-service:6061
    }

    # Socket.IO WebSocket endpoint for Pong
    handle /socket.io/* {
        reverse_proxy pong-service:6061 {
            # Enable WebSocket support
            header_up Upgrade {http.request.header.Upgrade}
            header_up Connection {http.request.header.Connection}
        }
    }

    # Chat service routes (HTTP + WebSocket) - for future use
    # handle /api/chat/* {
    #     uri strip_prefix /api/chat
    #     reverse_proxy chat-service:7000
    # }

    # Frontend - everything else (fallback)
    handle {
        reverse_proxy frontend:80
    }
}
