<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Pong Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  </head>

  <body style="background: #111; color: #eee; font-family: monospace; padding: 20px;">
    <h1>Pong Test Page</h1>

    <button onclick="joinCasualAI()">Join Casual vs AI</button>
    <button onclick="joinCasual()">Join Casual vs Human</button>

    <pre id="log"></pre>

    <script>
      const log = (msg) => {
        document.getElementById("log").textContent += msg + "\n";
      };

      // Connect to pong-service through Caddy
      const socket = io("http://localhost:8080", {
        path: "/socket.io",
        transports: ["websocket"]
      });

      socket.on("connect", () => log("Connected: " + socket.id));
      socket.on("waiting", (m) => log("Waiting: " + JSON.stringify(m)));
      socket.on("match_start", (m) => log("MATCH_START: " + JSON.stringify(m)));
      socket.on("state", (m) => log("STATE: " + JSON.stringify(m)));
      socket.on("match_end", (m) => log("MATCH_END: " + JSON.stringify(m)));
      socket.on("error", (m) => log("ERROR: " + JSON.stringify(m)));

      function joinCasualAI() {
        log("Joining AI...");
        socket.emit("join_casual", { vsAi: true });
      }

      function joinCasual() {
        log("Joining Human...");
        socket.emit("join_casual", { vsAi: false });
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowUp") socket.emit("input", { up: true });
        if (e.key === "ArrowDown") socket.emit("input", { down: true });
      });

      document.addEventListener("keyup", () => {
        socket.emit("input", { up: false, down: false });
      });
    </script>
  </body>
</html>
